<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mic Ultra-Low dB Visualizer</title>
<style>
  body {
    background: #050505;
    color: #00ffff;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    border: 1px solid #00ffff;
    margin-top: 20px;
  }
  input {
    width: 300px;
  }
</style>
</head>
<body>

<h2>Microphone Ultra-Quiet Audio Visualizer</h2>

<button id="start">Start Microphone</button><br><br>

<label>Gain Boost</label><br>
<input type="range" id="gain" min="1" max="200000" value="5000">
<div id="gainVal">5000x</div>

<canvas id="canvas" width="800" height="300"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
const gainNode = audioCtx.createGain();

analyser.fftSize = 2048;
gainNode.gain.value = 5000;

document.getElementById("gain").oninput = e => {
  gainNode.gain.value = e.target.value;
  document.getElementById("gainVal").innerText = e.target.value + "x";
};

document.getElementById("start").onclick = async () => {
  await audioCtx.resume();

  const stream = await navigator.mediaDevices.getUserMedia({
    audio: {
      echoCancellation: false,
      noiseSuppression: false,
      autoGainControl: false
    }
  });

  const mic = audioCtx.createMediaStreamSource(stream);

  mic.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(audioCtx.destination);

  visualize();
};

function visualize() {
  const data = new Uint8Array(analyser.frequencyBinCount);

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(data);

    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / data.length * 2;

    for (let i = 0; i < data.length; i++) {
      const h = data[i];
      ctx.fillStyle = `rgb(${h + 80},255,255)`;
      ctx.fillRect(i * barWidth, canvas.height, barWidth, -h);
    }
  }
  draw();
}
</script>

</body>
</html>
